#!/bin/bash -e
{{scratch.Set "env" (env "APP_ENV") -}}
{{$appname := env "APP_NAME" -}}
{{if scratch.Get "env" | contains "peer"}}{{scratch.Set "env" "stage"}}{{end -}}

{{$env := scratch.Get "env"}}

#global envs
{{range ls (printf "global/%s/env_vars" $env ) -}}
export {{.Key | toUpper}}="{{.Value}}"
{{end -}}
#app envs
{{range ls (printf "apps/%s/%s/env_vars" $appname $env ) -}}
export {{.Key | toUpper}}="{{.Value}}"
{{end -}}
